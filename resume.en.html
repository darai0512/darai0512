<!DOCTYPE html><html><head><title></title><meta charset="utf-8"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css"><style>pre code.hljs {
  display: block;
  overflow-x: auto;
  padding: 1em
}
code.hljs {
  padding: 3px 5px
}
/*!
  Theme: GitHub
  Description: Light theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Outdated base version: https://github.com/primer/github-syntax-light
  Current colors taken from GitHub's CSS
*/
.hljs {
  color: #24292e;
  background: #ffffff
}
.hljs-doctag,
.hljs-keyword,
.hljs-meta .hljs-keyword,
.hljs-template-tag,
.hljs-template-variable,
.hljs-type,
.hljs-variable.language_ {
  /* prettylights-syntax-keyword */
  color: #d73a49
}
.hljs-title,
.hljs-title.class_,
.hljs-title.class_.inherited__,
.hljs-title.function_ {
  /* prettylights-syntax-entity */
  color: #6f42c1
}
.hljs-attr,
.hljs-attribute,
.hljs-literal,
.hljs-meta,
.hljs-number,
.hljs-operator,
.hljs-variable,
.hljs-selector-attr,
.hljs-selector-class,
.hljs-selector-id {
  /* prettylights-syntax-constant */
  color: #005cc5
}
.hljs-regexp,
.hljs-string,
.hljs-meta .hljs-string {
  /* prettylights-syntax-string */
  color: #032f62
}
.hljs-built_in,
.hljs-symbol {
  /* prettylights-syntax-variable */
  color: #e36209
}
.hljs-comment,
.hljs-code,
.hljs-formula {
  /* prettylights-syntax-comment */
  color: #6a737d
}
.hljs-name,
.hljs-quote,
.hljs-selector-tag,
.hljs-selector-pseudo {
  /* prettylights-syntax-entity-tag */
  color: #22863a
}
.hljs-subst {
  /* prettylights-syntax-storage-modifier-import */
  color: #24292e
}
.hljs-section {
  /* prettylights-syntax-markup-heading */
  color: #005cc5;
  font-weight: bold
}
.hljs-bullet {
  /* prettylights-syntax-markup-list */
  color: #735c0f
}
.hljs-emphasis {
  /* prettylights-syntax-markup-italic */
  color: #24292e;
  font-style: italic
}
.hljs-strong {
  /* prettylights-syntax-markup-bold */
  color: #24292e;
  font-weight: bold
}
.hljs-addition {
  /* prettylights-syntax-markup-inserted */
  color: #22863a;
  background-color: #f0fff4
}
.hljs-deletion {
  /* prettylights-syntax-markup-deleted */
  color: #b31d28;
  background-color: #ffeef0
}
.hljs-char.escape_,
.hljs-link,
.hljs-params,
.hljs-property,
.hljs-punctuation,
.hljs-tag {
  /* purposely ignored */
  
}/*# sourceURL=/Users/daikiarai/workspace/darai0512/node_modules/highlight.js/styles/github.css*/</style><style>.markdown-body { font-size: 12px; background-color: rgba(255 255 255 / 0.8); }
.markdown-body thead { display: none; }
.page-break { page-break-after: always; }
.markdown-body pre > code { white-space: pre-wrap; }
.markdown-body h1::before { content: '# ';}
.markdown-body h2::before { content: '## ';}
.markdown-body h3::before { content: '### ';}</style></head>
	<body class="markdown-body">
		<h1 id="private-outputs">Private Outputs</h1>
<h2 id="web-games">Web Games</h2>
<ul>
<li><a href="https://air-poker.vercel.app/">AirPoker</a>: A game from a Japanese manga. <a href="https://github.com/darai0512/air-poker">Next.js + WebRTC + MongoDB</a></li>
<li><a href="https://to-court-the-king-js.vercel.app/">To Court the King</a>: A famous board game. <a href="https://github.com/darai0512/to-court-the-king.js">Next.js + WebRTC</a></li>
<li><a href="https://github.com/slack-codegolf">Slack CodeGolf</a>: Node.js + WebSocket + Heroku</li>
</ul>
<h2 id="oss-contributions">OSS Contributions</h2>
<ul>
<li>Node.js: <a href="https://github.com/nodejs/node/pull/11646">timers</a> and <a href="https://github.com/nodejs/node/pulls?q=is%3Apr+is%3Aclosed+author%3Adarai0512">hidden class optimizations, documentation, etc.</a></li>
<li>First release contributions &amp; reviews to AI TextToSpeech <a href="https://github.com/litagin02/Style-Bert-VITS2">Style-Bert-VITS2</a></li>
<li><a href="https://github.com/thuhcsi/NeuCoSVC">AI Singing Synthesis NeuCoSVC</a>, <a href="https://huggingface.co/kotoba-tech/kotoba-whisper-v2.2/discussions/1">kotoba-whisper HF pipeline</a></li>
<li>and more...</li>
</ul>
<h2 id="side-jobs">Side Jobs</h2>
<ul>
<li><a href="https://www.kakekomu.com/">Kakekomu (ST Booking)</a>: Assisted for about a month (Adding Notification, JWT encryption, unit test ...etc).</li>
<li><a href="https://meetsmore.com/">Meetsmore</a>: Assisted for about a month (Making ETL system from MongoDB to BigQuery with table/partition design by Digdag)</li>
<li>Smoothy: A side business with a Googler (sales). A reservation service for restaurants (React Native, service closed)</li>
<li><a href="https://www.kotoba.tech/">Kotoba Technologies</a>: Assisting now about AI product</li>
</ul>
<h2 id="others">Others</h2>
<ul>
<li>Conference speeches: <a href="https://github.com/darai0512/talks/blob/master/README.md">https://github.com/darai0512/talks/blob/master/README.md</a></li>
<li>Sales/Distributions:<ul>
<li>screen animation on OBS for Twitch streaming (js + WebSocket + css)</li>
<li>VR accessories created with Blender, AI models(RVC, VITS, LoRA)</li>
</ul>
</li>
<li>Hackathons:<ul>
<li>Domestic: Got the patent (an alarm game on iOS)</li>
<li>Taiwan: Participated twice with Taiwanese developpers</li>
</ul>
</li>
<li>Qualifications: Certified Scrum Developer (CSD)</li>
</ul>
<div class="page-break"></div>

<h1 id="work-online-payment-system-api--sdk">Work: Online Payment System (API &amp; SDK)</h1>
<h2 id="overview">Overview</h2>
<p>Worked at a B2B service company providing online credit card payment functions with PCI-DSS.</p>
<p>It achieved an IPO during my tenure.</p>
<h2 id="duration">Duration</h2>
<p>2018/12 - 2024/12 (as a side job during 2018/12 - 2019/12)</p>
<h2 id="scale">Scale</h2>
<p>Always operated with a small team of about five engineers (+ one PCI-DSS security specialist), all mid-career professionals.</p>
<h2 id="approach">Approach</h2>
<p>For maintenance and operation of the main payment service platform (BE: Python Gunicorn + Pyramid, DB: Aurora PostgreSQL, FE: Vue.js + Jinja) and back office (same stack), we adopted a Scrum format using Notion (previously Asana) for task management (fully remote since COVID-19).</p>
<p>All team members, including engineers, business staff, customer support, and managers, participated in the formulation and refinement of the product backlog, prioritizing and assigning points to tasks, and working through them in order.</p>
<p>For each separate project, we gathered and proceeded with similar management.</p>
<p>Ad-hoc tasks (calculating KPIs with Redash or BigQuery, responding to technical inquiries from client companies) were handled on a duty roster basis.</p>
<h2 id="achievements-6-highlights">Achievements (6 Highlights)</h2>
<h3 id="platform-service-renewal">Platform Service Renewal</h3>
<ul>
<li><strong>Effort</strong>: About 4 months with 3 engineers and 2 PMs</li>
<li><strong>Role</strong>: As a player, involved from requirements definition to DB design, BE design, and overall FE development</li>
<li><strong>Challenges</strong>:<ol>
<li>The Platform, a B2B2B function (our company to platformer to tenant), had issues due to the creation of a new account system, which meant we couldn't reuse code or data from the main service (cf. Managed as a monorepo, service logic based on accounts was shared across APIs, their GUI management screens, and back office in the main service).</li>
<li>There was a demand to use it in a B2B2C setting (our company to platformer to individual business owners), but the existing setup and data structure were not suitable.</li>
</ol>
</li>
<li><strong>Solution</strong>:<ul>
<li>By <strong>redesigning the data structure from scratch and integrating it into the account system of the main service</strong>, we were able to share code and data, and modified the main service so that new features could also be used on the Platform.<ul>
<li>Compared to the main service (B2B), the Platform (B2B2B) had nested account structures. After weighing the pros and cons, we decided not to use recursion but to integrate the root accounts into existing tables and separate nested parts into different tables, linking them to each resource with nullable foreign key constraints.</li>
<li>Unified the previously separate management screens. While differences arose in login screens and API structures after logging in (increased use of if-branches in UI components and services), we covered this with DI and flattening of nested structures, and the benefits of unification outweighed the drawbacks.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="automation-of-chargebacks-mechanism-to-forfeit-sales-in-case-of-fraud">Automation of Chargebacks (Mechanism to Forfeit Sales in Case of Fraud)</h3>
<ul>
<li><strong>Effort</strong>: About 6 months with 2 engineers and 1 PM</li>
<li><strong>Role</strong>: As the development leader, involved from planning and requirements definition to state transition diagram creation, DB design, BE design, and development</li>
<li><strong>Challenges</strong>:<ul>
<li>The chargeback process involved repeated email exchanges with upstream parties (like card companies) and merchants, and sending invoices—a complex manual workflow. The task was also becoming dependent on specific individuals.</li>
</ul>
</li>
<li><strong>Solution</strong>:<ul>
<li><strong>Participated from the stage of formulating exchange formats with upstream parties</strong>, aiming to standardize formats and workflows as much as possible. For remaining differences, we built batch processing that could flexibly read them.</li>
<li>Mapped the complex state transitions into a state machine.</li>
<li>To prevent users from preferring Excel input over the management screen's input form (UI of Excel format), we improved the design and enhanced features like auto-fill and batch import.</li>
<li>Created logic to offset amounts from sales proceeds, reducing the need to send invoices, which are prone to default and difficult to automate.</li>
</ul>
</li>
<li><strong>Development</strong>:<ul>
<li>Led two contract engineers (rotating every three months) as the only full-time engineer. To bridge the gap in domain knowledge, I facilitated frequent video calls and casual interactions, and used concrete code changes on GitHub to minimize misunderstandings instead of relying on specialized terminology.</li>
</ul>
</li>
</ul>
<h3 id="multi-account-support--pci-dss--vuejs-2-eol-support--design-overhaul">Multi-Account Support + PCI-DSS + Vue.js 2 EOL Support + Design Overhaul</h3>
<ul>
<li><strong>Effort</strong>: About 5 months with myself as the sole engineer, one designer, and one PM</li>
<li><strong>Role</strong>: As a player, involved from planning and requirements definition to DB, BE, and FE design and development</li>
<li><strong>Challenges</strong>:<ol>
<li>Revamp the management screen to allow multiple users with roles and permissions within a single account (similar to IAM), moving away from the one-company-one-account assignment.</li>
<li>Implement operation logs on the management screen as required by PCI-DSS.</li>
<li><strong>Migrate from Vue.js 2 to 3 due to EOL</strong>.</li>
<li>Overhaul the management screen design. <strong>The designer could interact via Figma but couldn't handle Vue.js or set up a local environment</strong>.</li>
</ol>
</li>
<li><strong>Solution</strong>:<ul>
<li>Created a role table logic that allows permissions management through settings in the Pyramid interface, with simple ERDs and interface expansions.</li>
<li>Achieved permissions management and operation recording without modifying code for over 100 endpoints, using decorator-based settings additions.</li>
<li>To facilitate communication with the PM and designer, ensured that staging deploys ran automatically, allowing for screen-based discussions. This reassured the PM and helped with quick bug reports and spec reviews.</li>
<li>For the Vue.js 2 to 3 migration, aimed for minimal changes by retaining the Options API from the 2.x assets.</li>
<li>The bottleneck was library compatibility: We used the VeeValidate library's 2.x version in over hundreds of places, but Vue 3 compatibility starts from VeeValidate 4.x, with many breaking changes between versions 2 to 3 to 4.</li>
<li><strong>Searched for a workaround to apply Vue 3 while still using VeeValidate 2.x without modifying the library internally</strong>, by exploring code-level solutions.</li>
<li>By extending non-public methods and properties and using mixins, managed to apply Vue 3 while keeping the existing code and VeeValidate 2.x.</li>
<li>Needed to address issues where input/change events and nextTick timings didn't align, causing real-time validation to fail. Leveraged knowledge of event loops to ensure appropriate nextTick usage.</li>
<li>While this migration method isn't fundamental (if vulnerabilities are found in VeeValidate, it's insufficient even if Vue vulnerabilities are addressed), we covered this by fixing the VeeValidate version (with no known vulnerabilities at that time), conducting QA from scratch, performing penetration tests during PCI-DSS audits, and establishing an exit strategy guideline (confirming that VeeValidate 2.x and 4.x can coexist within one package and using VeeValidate 4.x for new developments).</li>
</ul>
</li>
<li><strong>Remaining Challenges</strong>:<ul>
<li>Difficulty in collaborating with the designer.<ul>
<li>The cost of environment setup and learning Vue.js was a barrier, so we managed HTML, CSS, and JS in a separate repository, and I decomposed and integrated them into Vue.js. However, when designs were revised, it was easy to lose track of where to reflect those differences.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="addressing-advanced-technical-issues-eg-moving-away-from-custom-extended-cryptographypyopenssl">Addressing Advanced Technical Issues (e.g., Moving Away from Custom Extended Cryptography/PyOpenSSL)</h3>
<ul>
<li><strong>Challenges</strong>:<ul>
<li>At that time, PyOpenSSL didn't support certificate verification for Apple Pay (retrieving oid of X509Extension, ECDH derivation, etc.), so a predecessor had forked it for Apple Pay payment support. Later, due to OS updates and PCI-DSS compliance, we needed to move away from the old version of Cryptography/PyOpenSSL forked earlier, but there was no one with the surrounding knowledge after the predecessor left.</li>
</ul>
</li>
<li><strong>Solution</strong>:<ul>
<li>First, I read the code added in the fork, then compared it with the latest versions.</li>
<li>For example, support for X509Extension was included in the latest versions with certain libssl versions and conditional compilation (if-def macros), allowing us to discard some of the code added in the fork if conditions were met.</li>
<li>Wrote detailed tests and shared certificate verification and encryption logic with reviewers in an accessible manner. Managed to discard the fork and catch up with the main branch.</li>
</ul>
</li>
<li><strong>Others</strong>:<ul>
<li>Addressed issues like the exception handling in urllib3 when TLS handshake timeouts occur, where exceptions were broadly grouped under the same class, etc.</li>
</ul>
</li>
</ul>
<h3 id="containerization-and-infrastructure-overhaul">Containerization and Infrastructure Overhaul</h3>
<ul>
<li><strong>Effort</strong>: Initial technical investigation and basic setup by myself over six months, followed by three months with three engineers, one dedicated security specialist, and one PM.</li>
<li><strong>Challenges</strong>:<ul>
<li>To reduce the workload of PCI-DSS compliance tasks (e.g., constant OS updates), we moved away from self-managed EC2 instances and implemented:<ul>
<li>Containerization using Fargate</li>
<li>Infrastructure code management using Terraform</li>
<li>Replacing self-managed Nginx with a structure of CloudFront -&gt; ALB -&gt; ECS</li>
<li>Strict outbound policies (all external communication goes through a proxy)</li>
</ul>
</li>
</ul>
</li>
<li><strong>Solution</strong>:<ul>
<li>Structured Terraform directories using workspaces (multi-provider and module separation) to ensure identical configurations for staging and production.</li>
<li>Migrated Nginx functionalities like path rewrites, header additions, and rate limiting implemented in Lua to CloudFront Functions + Terraform.</li>
<li>Switched from Ansible deployment to deployment using Ecspresso described in Jsonnet.</li>
<li>Application modifications due to containerization: Moving away from filesystem dependencies, logging settings, environment variable-based configurations (reading settings from tfstate/secret manager).</li>
<li>Configured proxies for requests/urllib3/various SDKs (Sentry, BigQuery, OneLogin, etc.). While most could be handled with the HTTP_PROXY environment variable, care was needed as Boto3 for internal communication, which doesn't require a proxy, could be affected.</li>
</ul>
</li>
<li><strong>Note</strong>:<ul>
<li>Initially spent a few months planning for EKS (Kubernetes) with Helm + DevSpace. However, after warnings from the AWS support team about the challenges of long-term EKS operations and discovering features difficult to implement on EKS on Fargate, we shifted to ECS.</li>
</ul>
</li>
</ul>
<h3 id="sdk-maintenance-and-new-development">SDK Maintenance and New Development</h3>
<h4 id="js-card-information-input-library">JS Card Information Input Library</h4>
<p>Developed a <a href="https://pay.jp/docs/payjs">latest PCI-DSS compliant iframe-type (does not go through merchant domain) e-commerce JS library</a> in 1.5 months as a single engineer.</p>
<ul>
<li>Referenced globally recognized libraries through reverse engineering.</li>
<li>Expanded documentation such as <a href="https://pay.jp/docs/migrate-payjs-v1">samples aligned with Material Design</a> to support migration from previous JS versions that didn't meet requirements. Successfully achieved complete migration.</li>
</ul>
<p>Faced challenges in ensuring operation across various environments for end-users, unlike management screens where browsers can be restricted.</p>
<ul>
<li>Automated tests with Playwright for Chrome/Safari/Firefox.</li>
<li>Used BrowserStack for iOS, Android, and Windows.</li>
<li>Dealt with numerous edge cases, such as window.open not working only within the Line app's internal browser, or country code emojis not displaying correctly in select.options on Windows in the 3DSecure UI.</li>
<li>Verified that built artifacts stayed within scope (no global variables) using abstract syntax trees for testing.</li>
</ul>
<h4 id="mobile-card-information-input-libraries">Mobile Card Information Input Libraries</h4>
<p>Prepared libraries for <a href="https://github.com/payjp/payjp-ios">Swift</a> / <a href="https://github.com/payjp/payjp-android">Kotlin</a> / <a href="https://github.com/payjp/payjp-react-native-plugin">React Native + Expo</a> / <a href="https://github.com/payjp/payjp-flutter-plugin">Flutter</a>. Contributed by supporting and reviewing as a mobile-exclusive engineer.</p>
<h4 id="server-sdks">Server SDKs</h4>
<p>Maintained and operated SDKs for <a href="https://github.com/payjp/payjp-go">Go</a> / <a href="https://github.com/payjp/payjp-node">Node.js TypeScript</a> / <a href="https://github.com/payjp/payjp-php">PHP</a> / <a href="https://github.com/payjp/payjp-perl">Perl</a> / <a href="https://github.com/payjp/payjp-java">Java</a> / <a href="https://github.com/payjp/payjp-ruby">Ruby</a> / <a href="https://github.com/payjp/payjp-python">Python</a> as the only person capable of handling all languages.</p>
<ul>
<li>Focused on rich features beyond automatic generation from OpenAPI.<ul>
<li>Auto-retry on rate limits, automatic publishing via actions, realizing object structures avoiding circular references, etc.</li>
</ul>
</li>
<li>Paid special attention to Go.<ul>
<li>Addressed zero-value issues.</li>
<li>Faced challenges in representing cases where list structures contain resource structs, without using generics due to version support constraints.</li>
</ul>
</li>
<li>Published a <a href="https://github.com/darai0512/payjp-rust-with-openapi">non-official Rust SDK</a> and <a href="https://github.com/darai0512/payjp-rust-with-openapi/tree/main/openapi/docs">OpenAPI v3.1</a>.</li>
</ul>
<div class="page-break"></div>

<h1 id="work-launching-a-media-trading-web-service">Work: Launching a Media Trading Web Service</h1>
<h2 id="overview-1">Overview</h2>
<p>Released a service for buying and selling fan-fictions (images, videos, novels and VRM etc).</p>
<p>It had been in development for two years with a total of 10 people but had not been released.<br>Worked as a part-time contractor alongside my main job to launch the service.</p>
<h2 id="team-size">Team size</h2>
<p>3 + me</p>
<p>(When I joined, there are two university students as developers and a founder.)</p>
<h2 id="duration-1">Duration</h2>
<p>2019/10 - 2019/12 (as a side job)</p>
<h2 id="role-and-contributions">Role and Contributions</h2>
<p>As the development leader, I was involved in planning, design consolidation, requirements definition, task creation, and led two other engineers to launch the service in one and a half months.</p>
<h2 id="details">Details</h2>
<p>When I joined, there was only the founder and two university student developers.</p>
<p>After being briefed on the infrastructure and finding no screen transition diagrams, I listened to the requirements and read through the partially developed code on GitLab.</p>
<p>It was a microservices architecture with multiple servers communicating via gRPC, handling media processing (resizing images and videos, storing them in storage, etc.), APIs, dispatchers, and more, all written in Go language. The API and UI communicated via GraphQL.</p>
<p>The BE was being developed by a talented student, so I helped him complete the gRPC writing to get it running, then left the API server (GraphQL) and other parts to him.</p>
<p>Since the FE was less experienced, we shared tasks focusing on design, and I gradually helped him learn Vue and GraphQL.</p>
<p>I focused on creating pages: multimedia upload forms, PayPal payment and account registration forms, search functions, login, etc.</p>
<p>We were gathering at Yahoo! Japan's open Lodge at the time, so I joined after my main job, and after closing, we developed at a family restaurant. We released at 3 AM a month later at Joyfull Akasaka, and I still remember the joy of toasting.</p>
<div class="page-break"></div>

<h1 id="work-cross-departmental-language-nodejs-support-activities">Work: Cross-Departmental Language (Node.js) Support Activities</h1>
<h2 id="affiliation-and-duration">Affiliation and Duration</h2>
<p>Worked as a full-time employee at a major IT company, concurrently holding this position from 2018 until my resignation in 2019.</p>
<h2 id="overview-2">Overview</h2>
<p>With Node.js (version 10 at the time) adopted as a recommended language within the company and the arrival of a Node.js committer, a team was formed to support Node.js development across departments. As a concurrent role, I engaged in activities such as user training sessions, individual consultations for department-specific issues, external PR, and code reading sessions to enhance the team's capabilities.</p>
<h2 id="activity-achievements">Activity Achievements</h2>
<h3 id="user-training-sessions-and-consultations">User Training Sessions and Consultations</h3>
<p>Instead of covering topics like building an API server with Express, we focused on the four core foundational technologies of Node.js: Modules, <a href="https://techblog.yahoo.co.jp/advent-calendar-2016/node_new_buffer/">Buffer</a>, Events, and <a href="https://techblog.yahoo.co.jp/advent-calendar-2016/node-stream-highwatermark/">Stream</a>. The program was designed to help participants become self-sufficient in problem-solving by deeply understanding these areas (3 hours × 4 sessions, about 20 participants per session). The original materials and problem sets were well-received in post-session surveys, allowing us to run the program multiple times.</p>
<p>In consultations, we addressed issues like performance and scaling in a single-threaded environment (carefully explaining that these could be resolved through design), packet loss and memory leaks after switching from PHP (investigated with tcpdump to explain that Node.js itself wasn't the cause), and more.</p>
<p><strong>External PR</strong>:</p>
<ul>
<li>Presented at NodeFest 2018: <a href="https://nodefest.jp/2018/schedule.html#conference-2-3">https://nodefest.jp/2018/schedule.html#conference-2-3</a></li>
<li>Yahoo! Frontend Advent Calendar 2018: <a href="https://techblog.yahoo.co.jp/advent-calendar-2018/yahoo-frontend/">https://techblog.yahoo.co.jp/advent-calendar-2018/yahoo-frontend/</a></li>
<li>Interview on en-ambi: <a href="https://en-ambi.com/itcontents/entry/2019/08/08/103000/">https://en-ambi.com/itcontents/entry/2019/08/08/103000/</a></li>
</ul>
<h3 id="code-reading-sessions">Code Reading Sessions</h3>
<p>We read through Node.js code to create the above materials.</p>
<ul>
<li>Particularly focused on understanding the event loop by studying libuv and V8 under the guidance of a committer, which was immensely valuable.</li>
<li>Later, to cover communication and encryption for the second training session, we studied foundational technologies like TLS communication, HTTP2, and encryption based on Node.js implementations. This knowledge has been widely applicable in my work, making it the period when I grew the most as an engineer.</li>
</ul>
<p>Reference: <a href="https://techblog.yahoo.co.jp/entry/2020072830014370/">https://techblog.yahoo.co.jp/entry/2020072830014370/</a></p>
<div class="page-break"></div>

<h1 id="work-developing-dmp-data-management-platform">Work: Developing DMP (Data Management Platform)</h1>
<h2 id="affiliation-and-duration-1">Affiliation and Duration</h2>
<p>Worked as a full-time employee at a major ad distribution company (also with its own media) from 2016 until my resignation in 2019.</p>
<h2 id="challenges">Challenges</h2>
<p>In the sale of targeted advertising, as competitors increasingly utilized data, there was a desire to create a BI tool that would empower our sales team and agencies to make stronger proposals to advertisers.</p>
<p>We had a vast amount of data (over 1 TB compressed in HDFS for one day's worth of media access logs, over 2 billion PVs), managed via Hadoop, but when asked questions like "We want to raise awareness of our product among users of competitor X. How much reach will we have, and what are the demographics and usual behavior patterns of those users?", running MapReduce repeatedly in real-time was too time-consuming.</p>
<p>Additionally, there was a demand to analyze data combined with big data from advertisers.</p>
<h2 id="solution">Solution</h2>
<p>Developed a tool that could interface with third-party data, return results in seconds, and visualize them richly, using Hive + Solr and React + D3.</p>
<p><strong>Example</strong>:</p>
<p>An advertiser wants to deliver ads to a user list obtained by combining their "own user list A" with "user group B interested in competitors (searches, BT)" from our data, specifically targeting B and not A.</p>
<p>Before delivery, they can instantly visualize reach numbers and demographic information, and can adjust reach by extending the data period or adding other segments. Conversely, they can narrow down to female users in Tokyo.</p>
<h2 id="role-in-development">Role in Development</h2>
<p>In a project with 20 engineers, I developed six components (microservices).</p>
<p>Responsible for requirements definition and system design (initially mainly external design of some components, but later took on the grand design of the entire system), and handled development, testing, and maintenance of two components (a service that performs ETL and a UI server for visualization). Acted as PM for the ETL component.</p>
<h2 id="achievements">Achievements</h2>
<h3 id="design-and-operations">Design and Operations</h3>
<ul>
<li>Collaborated extensively to ensure the overall component diagram was loosely coupled without single points of failure. Despite being our first attempt at microservices and API orchestration, we completed it successfully.</li>
<li>As an engineer overseeing the entire system, I identified design issues in each component and facilitated adjustments.<ul>
<li>Anticipated potential issues by studying the technologies used across the system in advance, leading discussions during overall design, and gaining trust to manage progress and provide assistance during component-specific development. When deadlines were tight, participated in discussions on feature selection with a focus on overall optimization.</li>
</ul>
</li>
<li>In the backend, we partitioned data into long-term unchanging attribute data (residence, gender, etc.), short-term variable attribute data (devices, interests, etc.), and individual action data (searches, site visits, etc.), depending on the aggregation cycle. In the UI, we focused on abstracting these different data types so users could select them uniformly without being aware of the differences.</li>
<li>Recognized that third-party data structures could change easily. Changes in column types in Hive tables due to data restructuring could impact how data is selected in the UI. Conversely, limitations on the number of segments or aggregation period constraints in the UI required knowledge of Hive or Solr capacity and performance to set appropriately. As responsibilities were divided by microservices, coordination between data ingestion and UI teams was necessary. As someone who understood the entire system, I facilitated communication and acted as a bridge.</li>
</ul>
<h3 id="development">Development</h3>
<h4 id="from-php-to-nodejs">From PHP to Node.js</h4>
<p>Encouraged the team, which consisted of engineers with only PHP experience, to develop in Node.js due to the following advantages:</p>
<ul>
<li><strong>No Limit on Session Count</strong>:<ul>
<li>Reach calculations involve fetching data via APIs to the DWH (Solr). While results generally return in seconds, heavy conditions (e.g., long periods) without caching could take tens of seconds. With a PHP + Apache setup, Apache's PS would occupy requests during this time, limiting the scale of UI connections (MAX_CLIENTS &lt; 32767).</li>
</ul>
</li>
<li><strong>Seamless Integration with UI</strong>:<ul>
<li>Shared validation code between UI and FE.</li>
<li>Engineers were responsible for UI operation, which was developed by designers using React/Redux. There was a longstanding issue of engineers not being proficient in JS, posing challenges in UI operation. Learning Node.js and getting accustomed to JS lowered psychological barriers, even if not completely.</li>
</ul>
</li>
<li><strong>Support Through Company-Wide Node.js Assistance</strong>:<ul>
<li>As I was concurrently part of the company-wide Node.js support team, I could respond quickly to issues with libraries or the language itself.</li>
</ul>
</li>
<li><strong>Communicating Between UI and Hive/Solr via Custom Expressions</strong>:<ul>
<li>Created custom expressions (like "B and not A" from the earlier example) using PEG.js (parser generator).<ul>
<li>Using JS allowed us to reuse parsing and expression string generation between FE and BE.</li>
<li>Ensured expressions weren't overly customized and stayed close to Solr queries.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="communication-based-on-api-specifications-between-services">Communication Based on API Specifications Between Services</h4>
<p>Introduced API Blueprint for creating API specifications and shared the method across the project.</p>
<ul>
<li>Used Markdown to generate specifications and mock servers with Aglio/Drakov.</li>
<li>Chose API Blueprint over OpenAPI (then Swagger) because PMs who were non-engineers could write and access specifications in Markdown format.</li>
<li>In hindsight in 2024, API Blueprint has become obsolete, and using Swagger (OpenAPI) specifications would have allowed for longer-term utilization.</li>
<li>However, at the time, the crucial needs were:<ul>
<li>Base communication between FE and BE on API specifications.</li>
<li>Allow anyone to write and access specifications.</li>
<li>Ensure documentation and mock servers were synchronized.</li>
<li>We achieved sufficient results with API Blueprint under these requirements.</li>
</ul>
</li>
<li>There were no plans for external API exposure, and the automatically generated Node.js code from Swagger at the time wasn't very useful.</li>
</ul>
<h2 id="challenges-faced">Challenges Faced</h2>
<ul>
<li>Handling dates and periods in data was complex, causing difficulties in coordinating between components.<ul>
<li>Partitions were based on daily dates (generally log_date).</li>
<li>In Hive pre-processing during ETL, the date within the log (when the event occurred) and the date when data shaping was completed always differed by at least one day. Complex conditions could take more than two days to generate. Third-party data often contained logs from multiple dates.</li>
<li>If the meaning of dates differed, correct results couldn't be obtained. Since the meaning of dates displayed in the UI could vary per data, careful handling was necessary.</li>
<li>Recognized the need for a component to centrally manage such metadata and developed an additional component.</li>
</ul>
</li>
<li>For machine learning purposes, at least a year's worth of data was needed to account for seasonal variations. However, the DWH (used in Solr's in-memory operations) couldn't retain data for such long periods, requiring trial and error.</li>
<li><strong>Hive is Not SQL</strong>:<ul>
<li>There were differences in behavior compared to intuitive SQL understanding when parsing queries, significantly impacting performance if one couldn't imagine how queries translated into MapReduce jobs.</li>
<li>While SQL injection could be prevented with libraries, when converting custom expressions to HQL, one had to be cautious about injections. After release, unescaped '%' in strings passed from the UI led to looser conditions and processing delays (MapReduce didn't finish even after dozens of hours).</li>
</ul>
</li>
</ul>
<div class="page-break"></div>

<h1 id="work-improving-the-metadata-generation-system-for-machine-learning">Work: Improving the Metadata Generation System for Machine Learning</h1>
<h2 id="affiliation-and-duration-2">Affiliation and Duration</h2>
<p>Assigned as my first job upon joining a major ad distribution company (also with its own media) as a full-time employee from the end of 2013 to 2015. Continued maintenance and operation until resignation.</p>
<h2 id="background">Background</h2>
<p>Our five-member team was responsible for creating user lists for behaviorally targeted (BT) advertisements that generated annual sales exceeding 1 billion yen. To improve the accuracy of the gradient boosting-based machine learning logic used in generating these lists, we enhanced the training data by adding metadata. This metadata was manually processed by another department, but due to legacy systems and inefficient operations, we revamped the tools and operational methods.</p>
<p>While generating user lists for behavioral targeting (BT) ads using machine learning logic based on gradient boosting, we enhanced accuracy by attaching metadata to the logs used for training.</p>
<p>This metadata was being created manually by another department using legacy tools, which needed to be overhauled.</p>
<h2 id="role-and-developed-products">Role and Developed Products</h2>
<p>In a project with a PM and one developer (myself), I was responsible for development and operation of the following:</p>
<p>A. UI/FE/BE for creating metadata (linking behavioral content with interests) (e.g., associating the search term "Hawaii travel" with the overseas travel tag, or linking the Nintendo DS ad creative with the games tag)</p>
<p>B. A system that uses MapReduce to lookup action logs with the dictionary from A, performs rule-based modeling, and creates user lists by interest.</p>
<h2 id="actions-taken-and-achievements">Actions Taken and Achievements</h2>
<h3 id="regarding-a">Regarding A</h3>
<ul>
<li><strong>Migration from Oracle 9i to 12c</strong>:<ul>
<li>The legacy system was extremely slow, retrieving data via Oracle's Database Link (Materialized View) and performing shaping and processing with PL/SQL.</li>
<li>Replaced PL/SQL processing with more readable ANSI SQL or moved it to the language side to enable unit testing.</li>
<li>Simultaneously reviewed the DB design to improve speed.</li>
<li>Undertook careful redesign and necessary data migration, collaborating closely with the PM after thoroughly understanding the code due to the significant overhaul.</li>
</ul>
</li>
<li><strong>Data Migration from Isilon</strong>:<ul>
<li>Distribution of dictionary data to B was done via Isilon, but mounting was only possible on physical machines, limiting scalability and posing risks if the machine failed. Switched to an in-house S3-compatible storage.</li>
</ul>
</li>
<li><strong>Rewrote Perl Batches Lacking Unit Tests</strong>, aligning processing with the new DB design, and prepared unit tests and smoke tests.</li>
<li><strong>Rewrote New Functional Aspects Using Python's Django</strong>:<ul>
<li>Chose Python because many new graduates could use it.</li>
<li>Selected Django because django-nose automatically created test tables for each test, allowing SQL-included tests and clean-up after completion.</li>
</ul>
</li>
<li><strong>UI Improvements</strong>:<ul>
<li>Since the UI was a proprietary PHP framework without documentation, created E2E tests with CasperJS before the overhaul.<ul>
<li>However, it was too time-consuming. Initially, developed test code on Mac using NightmareJS 2.x (Electron), which had intuitive APIs and fast performance, and operated it on an independent CI. When a company-wide CI was introduced and enforced, the only available environments were CentOS 6 or 7, and the then-current Electron couldn't be built, leading to abandoning the E2E code.</li>
<li>Rewrote using CasperJS (running on PhantomJS), but soon after, PhantomJS announced end-of-life. At that time, Puppeteer and Playwright didn't exist, and choosing Selenium might have been the next best option.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Collaborated with Regional Teams Responsible for Metadata Assignment</strong>, frequently communicating via business trips and video calls to improve the UI. Also conducted data analysis to implement operational improvements.<ul>
<li>Discovered through interviews that due to historical reasons, they were assigning metadata in order of ad submission. As a result, many new ads lacked metadata.</li>
<li>Since ad creatives and video views had the most weight in BT learning impact, I conducted data analysis alongside development. Found that including ads with high click counts significantly improved final effectiveness (predicted increase in reach). Proposed and implemented a feature to prioritize tasks based on click counts, which was adopted.</li>
</ul>
</li>
</ul>
<h3 id="regarding-b">Regarding B</h3>
<ul>
<li><strong>Added New Ad Data to Increase Training Data</strong>, coordinating with data providers for new data ingestion, parsing new logs in MapReduce, adding rule-based modeling in machine learning, and conducting numerical verification.<ul>
<li>Migrated from Hadoop processing to Hive (OnTez) for speed improvements and resource reduction.</li>
<li>Implemented Hive commands with Oozie to leverage Oozie coordinator's rerun functionality during operations.</li>
<li>Implemented HDFS upload processing and HDFS to S3 transfer processing using HttpFS commands (REST API).</li>
</ul>
</li>
</ul>
<p>(end)</p>

	

</body></html>